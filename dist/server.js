(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.i=function(d){return d},b.d=function(d,e,f){b.o(d,e)||Object.defineProperty(d,e,{configurable:!1,enumerable:!0,get:f})},b.n=function(d){var e=d&&d.__esModule?function(){return d['default']}:function(){return d};return b.d(e,'a',e),e},b.o=function(d,e){return Object.prototype.hasOwnProperty.call(d,e)},b.p='',b(b.s=10)})([function(a,b,c){'use strict';(function(d){var f=c(23),g=c.n(f),h=c(11);const i=process.env.NODE_ENV||'development';b.a=function(){let j={};return'development'===i||'production'===i?j=h.a[i]:void 0,j.publicPath=g.a.join(d,'public'),j.runMode=i,j}}).call(b,'server/utilities')},function(a,b,c){'use strict';var d=c(0),e=c(16),f=c(3),g=c.n(f),h=c(19),i=c.n(h),j=c(17),k=c.n(j);const l=10;let m=new g.a.Schema({email:{type:String,require:!0,unique:!0},firstName:{type:String,require:!0},lastName:{type:String,require:!0},isAdmin:{type:Boolean,default:!1},password:{type:String,require:!0,select:!1},facebook:{id:String,token:String,photo:String}},{timestamps:!0});m.pre('save',function(n){this.isModified('firstName')&&(this.firstName=e.a.capitalizeWords(this.firstName)),this.isModified('lastName')&&(this.lastName=this.lastName.toUpperCase()),this.isModified('password')?k.a.genSalt(l,(p,q)=>{p?n(p):k.a.hash(this.password,q,(r,s)=>{r?n(r):(this.password=s,n())})}):n()}),m.pre('update',function(n){var p=this._update.$set;p.firstName&&(p.firstName=e.a.capitalizeWords(p.firstName)),p.lastName&&(p.lastName=p.lastName.toUpperCase()),p.password?k.a.genSalt(l,(q,r)=>{q?n(q):k.a.hash(p.password,r,(s,t)=>{s?n(s):(p.password=t,n())})}):n()}),m.methods.validPassword=function(n,p){k.a.compare(n,this.password,function(q,r){q?p(q):p(null,r)})},m.methods.generateJWT=function(){let n=c.i(d.a)();return i.a.sign({_id:this._id,email:this.email,firstName:this.firstName,lastName:this.lastName,isAdmin:this.isAdmin},n.jwtSecret,{expiresIn:'7d'})},m.methods.fullName=function(){return this.firstName+' '+this.lastName},b.a=g.a.model('User',m)},function(a){a.exports=require('express')},function(a){a.exports=require('mongoose')},function(a,b,c){'use strict';var d=c(21),e=c.n(d),f=c(22),g=c.n(f),h=c(1),i=c(0),j=c(20),k=c.n(j);b.a=()=>{let l=c.i(i.a)();return k.a.serializeUser(function(m,n){n(null,m.id)}),k.a.deserializeUser(function(m,n){USER.findById(m,function(p,q){n(p,q)})}),k.a.use(new g.a.Strategy({usernameField:'email'},(m,n,p)=>{process.nextTick(function(){h.a.findOne({email:m}).select('+password').exec(function(q,r){return q?p(q):r?void r.validPassword(n,function(s,t){return s||!t?p(null,!1,{message:'Incorrect email or password.'}):p(null,r)}):p(null,!1,{message:'Incorrect email or password.'})})})})),k.a.use(new e.a({clientID:l.facebookAuth.clientID,clientSecret:l.facebookAuth.clientSecret,callbackURL:'/auth/facebook/callback',profileFields:['id','name','photos','emails']},(m,n,p,q)=>{process.nextTick(function(){h.a.findOne({'facebook.id':p.id},(r,s)=>{if(r)return q(r);if(s)return q(null,s);let t=new h.a;t.email=p.emails[0].value||'',t.firstName=p.name.givenName,t.lastName=p.name.familyName,t.facebook.id=p.id,t.facebook.token=m,t.facebook.photo=p.photos[0].value||'',t.save((u)=>{if(u)throw u;return q(null,t)})})})})),k.a}},function(a,b,c){'use strict';var d=c(18),e=c.n(d),f=c(2),g=c.n(f),h=c(0),i=c(15),j=c(14);b.a=(k,l)=>{const m=g.a.Router(),n=c.i(h.a)();let p=e()({secret:n.jwtSecret,getToken:(q)=>{return q.cookies[n.cookieToken]}});return c.i(i.a)(m,p),c.i(j.a)(m,l),m}},function(a){a.exports=require('body-parser')},function(a){a.exports=require('cookie-parser')},function(a){a.exports=require('debug')},function(a){a.exports=require('morgan')},function(a,b,c){'use strict';Object.defineProperty(b,'__esModule',{value:!0}),function(d){var e=c(2),f=c.n(e),g=c(3),h=c.n(g),i=c(6),j=c.n(i),k=c(7),l=c.n(k),m=c(8),n=c.n(m),p=c(9),q=c.n(p),r=c(4),s=c(5),t=c(0);let u=c.i(r.a)(),v=c.i(t.a)(),w=f()();const x=parseInt(process.env.PORT,10)||8080;'production'==v.runMode?w.use(q()('prod',{skip:function(y,z){return 400>z.statusCode},stream:d+'./mean.log'})):w.use(q()('dev')),w.use(j.a.json()),w.use(j.a.urlencoded({extended:!1})),w.use(l()()),w.use(f.a.static(v.publicPath)),w.use(u.initialize()),w.use('/api',c.i(s.a)(w,u)),w.get('/',function(y,z){z.sendFile('index.html',{root:v.publicPath})}),w.use((y,z)=>{z.status(404).send('The requested page doesn\'t exist!')}),w.use(function(y,z,A){console.error(y.stack),A.status(500).send('Something broke!')}),h.a.connect(v.db,function(y){if(y)throw y;n()('Successfully connected to MongoDB'),w.listen(x,function(){n()('Listening on port '+x)})})}.call(b,'')},function(a,b){'use strict';let d={development:{db:process.env.MONGODB_URI||'mongodb://localhost:27017/mean-sample-dev',cookieToken:'mean-token-dev',jwtSecret:'cJbdB3t$',facebookAuth:{clientID:'000000',clientSecret:'00000',callbackURL:'cb'}},production:{db:process.env.MONGODB_URI||'mongodb://localhost:27017/mean-sample',cookieToken:'mean-token',jwtSecret:'cJbdB3t$',facebookAuth:{clientID:'000000',clientSecret:'00000',callbackURL:'cb'}}};b.a=d},function(a,b,c){'use strict';var d=c(1);b.a=class{local(f,g,h,i){return i.authenticate('local',(j,k,l)=>{j?h(j):k?g.json({token:k.generateJWT()}):g.status(401).json(l)})(f,g,h)}facebook(f){return f.authenticate('facebook')}authenticate(f,g){if(f.user){let i=new d.a(f.user),j=i.generateJWT();g.redirect('/#!/auth/callback/'+j)}else g.send(401)}}},function(a,b,c){'use strict';var d=c(1);b.a=class{find(f,g,h,i){i&&i.isAdmin?d.a.find(f.query,(j,k)=>{j?h(j):g.json(k)}):g.status('401').send('Not authorized, your are not admin!')}findById(f,g,h,i){i&&(f.params.id==i._id||i.isAdmin)?d.a.findById(f.params.id,(j,k)=>{j?h(j):g.json(k)}):g.status('401').send('Not authorized, your are not admin!')}create(f,g,h){d.a.create(f.body,(i,j)=>{if(i)h(i);else{var k=j.toObject();delete k.password,g.send(k)}})}update(f,g,h){currentUser&&(f.params.id==currentUser._id||currentUser.isAdmin)?d.a.update({_id:f.params.id},f.body,(j)=>{j?h(j):g.sendStatus(200)}):g.status('401').send('Not authorized, your are not admin!')}delete(f,g,h,i){i&&i.isAdmin?d.a.findByIdAndRemove(f.params.id,()=>{g.sendStatus(200)}):g.status('401').send('Not authorized, your are not admin!')}}},function(a,b,c){'use strict';var d=c(12);b.a=(e,f)=>{let g=new d.a(f);e.post('/auth',(h,i,j)=>{return g.local(h,i,j,f)}),e.get('/auth/facebook',f.authenticate('facebook',{scope:'email'})),e.get('/auth/facebook/callback',g.facebook(f),(h,i,j)=>{return g.authenticate(h,i,j)})}},function(a,b,c){'use strict';var d=c(13);b.a=(e,f)=>{let g=new d.a;e.get('/users',f,function(h,i,j){return g.find(h,i,j,h.user)}),e.get('/users/:id',f,function(h,i,j){return g.findById(h,i,j,h.user)}),e.post('/users',function(h,i,j){return g.create(h,i,j)}),e.put('/users/:id',function(h,i,j){return g.update(h,i,j,h.user)}),e.delete('/users/:id',function(h,i,j){return g.delete(h,i,j,h.user)})}},function(a,b){'use strict';b.a={capitalizeWords:function(d){return d.replace(/\w\S*/g,(e)=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase())}}},function(a){a.exports=require('bcrypt')},function(a){a.exports=require('express-jwt')},function(a){a.exports=require('jsonwebtoken')},function(a){a.exports=require('passport')},function(a){a.exports=require('passport-facebook')},function(a){a.exports=require('passport-local')},function(a){a.exports=require('path')}]);